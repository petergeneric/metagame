<h1>Advanced Search</h1>

<p>Use powerful query syntax for complex searches. Queries consist of selectors that filter and constrain results.</p>

<h2>Query Structure</h2>

<p>A search query is composed of one or more <strong>selectors</strong> in the form <code>name:value</code>, optionally followed by a tail for additional filtering:</p>

<ul>
  <li><code>selector:value</code> - Basic selector</li>
  <li><code>1-1234</code> or <code>1-100,2-200</code> - Lead number constraints (tail)</li>
  <li>Free text at the end applies a substring match</li>
</ul>

<h2>Selectors</h2>

<h3>near:</h3>
<p>Constrain results to locations within a set distance from a point of interest.</p>
<p><strong>Form:</strong> <code>near:location,[distance],[substring],[limit]</code></p>
<p><strong>Defaults:</strong> Distance: 3km, Substring: none, Limit: none</p>
<p><strong>Examples:</strong></p>
<ul>
  <li><code class="search" data-tab="advanced">near:here</code> - Within default distance of map centre</li>
  <li><code class="search" data-tab="advanced">near:anchor</code> - Within default distance of current anchor</li>
  <li><code class="search" data-tab="advanced">near:anchor,1mi</code> - Within 1 mile of the anchor</li>
  <li><code class="search" data-tab="advanced">near:1-1234</code> - Near a specific lead</li>
  <li><code class="search" data-tab="advanced">near:LI-20</code> - Near a building</li>
  <li><code class="search" data-tab="advanced">near:993488,223292</code> - Near EPSG:2263 coordinates</li>
  <li><code class="search" data-tab="advanced">near:LI-20,1mi,bar,10</code> - The 10 nearest bars to LI-20</li>
</ul>

<h3>contains:</h3>
<p>Filter results where the search text contains the specified string. Multiple values are ORed together.</p>
<p><strong>Form:</strong> <code>contains:value,[value2],...</code></p>
<p><strong>Examples:</strong></p>
<ul>
  <li><code class="search" data-tab="advanced">contains:bar</code></li>
  <li><code class="search" data-tab="advanced">contains:1-1234</code></li>
  <li><code class="search" data-tab="advanced">contains:Subway,Railway</code></li>
</ul>

<h3>namecontains:</h3>
<p>Like <code>contains:</code>, but only applies to the record's display name.</p>

<h3>namestarts:</h3>
<p>Like <code>namecontains:</code> but anchored to the start, behaving like White Pages searches.</p>

<h3>is:</h3>
<p>Filter results by properties. Multiple arguments are ORed together.</p>
<p><strong>Form:</strong> <code>is:property,[property2],...</code></p>
<p><strong>Properties:</strong></p>
<ul>
  <li><code class="search" data-tab="advanced">is:place</code> - Non-person entries</li>
  <li><code class="search" data-tab="advanced">is:person</code> - Person entries only</li>
  <li data-if-system="nynoir"><code class="search" data-search="is:unlisted limit:100" data-tab="advanced">is:listed</code> - Publicly listed entries</li>
  <li data-if-system="nynoir"><code class="search" data-search="is:unlisted limit:100" data-tab="advanced">is:unlisted</code> - Private/unlisted entries</li>
  <li data-if-system="nynoir"><code class="search" data-tab="advanced">is:poi</code> - Points of interest</li>
  <li data-if-system="nynoir"><code class="search" data-tab="advanced">is:bus</code> - Bus stops only</li>
  <li data-if-system="nynoir"><code class="search" data-tab="advanced">is:subway</code> - Subway stops only</li>
  <li><em>category tags</em> - e.g., <code class="search" data-tab="advanced">is:bakery</code>, <code class="search" data-tab="advanced">is:bar</code>, <code class="search" data-tab="advanced">is:restaurant</code></li>
  <li data-if-system="nynoir"><code class="search" data-search="is:male limit:100" data-tab="advanced">is:male</code> - gender (<a href="#" data-tab="advanced" data-search="is:male limit:100">male</a>, <a href="#" data-tab="advanced" data-search="is:female limit:100">female</a>, or <a href="#" data-tab="advanced" data-search="is:ungendered limit:100">ungendered</a>). Male/Female searches also match Ungendered people.</li>
  <li data-if-system="nynoir"><code class="search" data-tab="advanced">is:ethnicity:irish</code> - Search by ethnicity (see <a href="#" data-topic="nynoir-people-properties">People Properties</a> for full list)</li>
  <li><code class="search" data-tab="advanced">is:icon.blank</code> - Entries with generic place icon</li>
</ul>

<h3>region:</h3>
<p>Constrain results to specific map neighbourhoods.</p>
<p><strong>Form:</strong> <code>region:region1,[region2],...</code></p>
<p><strong>Examples:</strong></p>
<ul>
  <li><code class="search" data-tab="advanced">region:LI</code></li>
  <li><code class="search" data-tab="advanced">region:LI,CS</code></li>
</ul>

<h3>fuzzyregion:</h3>
<p>Like <code>region:</code>, but includes the specified regions AND their adjacent neighbours.</p>
<p><strong>Examples:</strong></p>
<ul>
  <li><code class="search" data-tab="advanced">fuzzyregion:LI</code></li>
  <li><code class="search" data-tab="advanced">fuzzyregion:here</code></li>
</ul>

<h3>besideregion:</h3>
<p>Like <code>fuzzyregion:</code>, but only searches in adjacent regions, not the specified regions themselves.</p>
<p>e.g. <code class="search" data-tab="advanced">besideregion:LI</code></p>

<h3>limit:</h3>
<p>Limit results to the first N items.</p>
<p><strong>Form:</strong> <code>limit:N</code></p>

<h3>random:</h3>
<p>Select N items at random from the result set.</p>
<p><strong>Form:</strong> <code>random:N</code></p>

<h2>Sorting by Distance</h2>

<p>Add a distance sort to be performed at the end of the search pipeline:</p>
<p><strong>Form:</strong> <code>distance:anchor,[max distance],[limit]</code></p>
<p>Note: <code>distance:</code> is intended for sorting, not filtering. For filtering, use <code>near:</code> instead. Since sorting happens after <code>limit:</code> or <code>random:</code>, results may be unintuitive if combined.</p>

<h2>Distance Units</h2>

<p>Distances are specified as <code>[amount][unit]</code> with no space. Amounts can include decimals.</p>
<ul>
  <li><code>m</code> - meters</li>
  <li><code>km</code> - kilometers</li>
  <li><code>ft</code> - feet</li>
  <li><code>mi</code> - miles</li>
</ul>

<h2>Referencing Locations</h2>

<p>Selectors accept locations in these formats:</p>
<ul>
  <li><code>here</code> - Current map centre</li>
  <li><code>anchor</code> - Current anchor pin (fails if no anchor set)</li>
  <li><code>1-1234</code> - A lead number</li>
  <li><code>LI-20</code> - A building reference</li>
  <li><code>x,y</code> - EPSG:2263 coordinate pair</li>
</ul>
